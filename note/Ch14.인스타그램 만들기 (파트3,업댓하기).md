## 14.2 SWR ì´í•´í•˜ê¸°

- ê¼­ í•œë²ˆ ì½ì–´ë³´ê¸°

  - https://swr.vercel.app/ko/docs/advanced/understanding

- Fetch and Revalidate

  - Revalidateì—ì„œëŠ” isValidatingë§Œ trueê°€ ëœë‹¤

- Key Change

  - keyê°€ ë³€ê²½ë˜ë©´ isLoading, isValidating ëª¨ë‘ trueê°€ ëœë‹¤

<img src='./images/14-1-1.png'>

- ë‘ë²ˆì§¸ ìš”ì²­ì„ í•˜ê²Œ ë˜ë©´ staleí•œ ê²ƒ ë³´ì—¬ì£¼ë©´ì„œ ë°±ê·¸ë¼ìš´ë“œ ìƒìœ¼ë¡œëŠ” ë‹¤ì‹œ ì„œë²„ì— ìš”ì²­í•´ì„œ ìºì‹œëœ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤

- ë§Œì•½ ë³€ê²½ì‚¬í•­ì´ ì—†ë‹¤ë©´ UI ê·¸ëŒ€ë¡œ ë³´ì´ê² ì§€ë§Œ ë³€ê²½ì‚¬í•­ì´ ìˆë‹¤ë©´ UIê°€ ì—…ë°ì´íŠ¸ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

---

## 14.3 ì¢‹ì•„ìš” í† ê¸€í•˜ê¸°â“

- https://www.sanity.io/docs/js-client

- https://next-auth.js.org/configuration/callbacks

- https://swr.vercel.app/docs/mutation

---

## 14.4 ì¢‹ì•„ìš”ğŸ’¡- í† ê¸€ë²„íŠ¼

### Q.

- ìŒ.. ê°œë…ì´ í—·ê°ˆë¦¬ëŠ” ê±° ê°™ì€ë° ìš°ì„  ì œ ìƒê°ì—ëŠ” ActionBar ì»´í¬ë„ŒíŠ¸ 'use client' ë¡œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì§€ì •í•´ì•¼í•˜ì§€ ì•Šë‚˜? ìƒê°ì´ ë“œëŠ”ë°.. ì—ëŸ¬ê°€ ì•ˆë‚˜ëŠ”ê±°ë³´ë‹ˆ ì•„ì§ ê°œë…ì´ ë¶€ì¡±í•œê±° ê°™ìŠµë‹ˆë‹¤.

- ê·¸ë˜ì„œ ê¶ê¸ˆí•œ ë‚´ìš©ì€ ActionBar ì»´í¬ë„ŒíŠ¸ëŠ” ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œ ì‚¬ìš©í•´ì•¼í•˜ì§€ ì•Šë‚˜? ìƒê°ì´ ë“­ë‹ˆë‹¤.

- ê·¼ë° í•´ë‹¹ ê°•ì˜ ë‚´ìš©ì—ì„œëŠ” ê·¸ë ‡ì§€ ì•Šì•„ì„œ? í´ë¼ì´ì–¸íŠ¸ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì´ìœ ì™€? ì„œë²„ ì»´í¬ë„ŒíŠ¸?ì—ì„œ ìƒíƒœë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì´ìœ ë„ ê¶ê¸ˆí•˜ë„¤ìš”ã… ã… 

### A.

- ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ê°€ ì„œë²„ ì»´í¬ë„ŒíŠ¸ì¸ì§€ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì¸ì§€ëŠ” ì»´í¬ë„ŒíŠ¸ íŒŒì¼ì— "use client" ì„ ì–¸ ì—¬ë¶€ì— ë”°ë¼ì„œ ê²°ì •ë˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.

- ì–´ë–¤ í˜ì´ì§€ì— ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ì¤‘ì²©ë˜ì–´ ìˆì„ ë•Œ "use client"ëŠ” "use client"ë¥¼ ì„ ì–¸í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ í¬í•¨í•´ì„œ ìì‹(ìì†) ì»´í¬ë„ŒíŠ¸ë“¤ì„ ëª¨ë‘ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œ ê°„ì£¼í•˜ê² ë‹¤ëŠ” ì¼ì¢…ì˜ ì„ ì–¸ê³¼ ê°™ìŠµë‹ˆë‹¤.

- ActionBar ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì— ëŒ€í•œ ì˜ì¡´ì„± ê·¸ë˜í”„ë¥¼ ê·¸ë ¤ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```shell
PostListCard -> ActionBar

PostListCard -> PostDetail -> ActionBar

PostGridCard -> PostDetail -> ActionBar
```

- PostListCard íŒŒì¼ê³¼ PostGridCard íŒŒì¼ì—ëŠ” ëª¨ë‘ "use client"ê°€ ì„ ì–¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê·¸ ìì‹(ìì†) ì»´í¬ë„ŒíŠ¸ì¸ ActionBar ëŠ” ìë™ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œì¨ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤.

- ì•„ë˜ ê³µì‹ ë¬¸ì„œë¥¼ ì½ì–´ë³´ì‹œë©´ ì¢€ ë” ì´í•´í•˜ì‹œëŠ”ë° ë„ì›€ì´ ë˜ì‹¤ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

  - https://beta.nextjs.org/docs/rendering/server-and-client-components

- í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì˜ ìì‹ ì»´í¬ë„ŒíŠ¸ë¡œ ì„œë²„ ì»´í¬ë„ŒíŠ¸ê°€ ì˜¬ ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” í•´ë‹¹ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì˜ children propsë¡œ ë“¤ì–´ê°”ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

  - https://nextjs.org/docs/app/building-your-application/rendering/composition-patterns#interleaving-server-and-client-components

---

## 14.5 ì¢‹ì•„ìš”ğŸ’¡- ë¼ìš°íŠ¸í•¸ë“¤ëŸ¬

- https://www.sanity.io/docs/js-client#appendingprepending-elements-to-an-array

- https://next-auth.js.org/configuration/callbacks#jwt-callback

---

## 14.7 ì¢‹ì•„ìš”ğŸ’¡- ì»¤ìŠ¤í…€ í›…ğŸª

### Q. useSWR vs Fetch

- posts ëŠ” useSWR ì„ ì´ìš©í•˜ì—¬ ê°€ì ¸ì˜¤ê³  likes ëŠ” ì¼ë°˜ fetch api ì´ìš©í–ˆëŠ”ë°

- ì–¸ì œ ì–´ëŠê²ƒì„ ì´ìš©í•´ì•¼ í•˜ëŠ”ì§€ í˜¼ë€ì´ ì˜µë‹ˆë‹¤. ëª…í™•í•œ ë‹µë³€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

### A

- ìºì‹±ì´ í•„ìš”í•œ ë°ì´í„°(posts)ëŠ” swrì„ ì‚¬ìš©í•˜ê³  ìºì‹±ì„ í•˜ë©´ ì•ˆë˜ëŠ” ë™ì ì¸ ë°ì´í„°ëŠ” fetchí˜¹ì€ axiosë¥¼ ì‚¬ìš©í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

  - humanb2boxë‹˜ ë‹µë³€ì´ ì •í™•í•©ë‹ˆë‹¤ ğŸ‘

  - ì½ì–´ì˜¤ëŠ” GET ìš”ì²­ì€ swr ì‚¬ìš©í•˜ë©´ ë˜ê³ ,

  - PUT, DELETE, PATCH ê°™ì€ ìˆ˜ì •í•˜ëŠ” ìš”ì²­ì€ ì¼ë°˜ fetch API ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤

---

## 14.11 ë¶ë§ˆí¬ğŸ’¡- UI

### Q. Bookmark ì—…ë°ì´íŠ¸ê°€ ì•ˆë˜ëŠ” ë¬¸ì œ

### A.

- 14.22 ì±•í„°ì˜ ì§ˆë¬¸ì— ì–´ë–¤ë¶„ì´ ë‚¨ê²¨ì£¼ì‹  ë‹µë³€ ìš”ì•½ ì…ë‹ˆë‹¤.

- í•´ë‹¹ ì±•í„°ê°€ì…”ì„œ ë‚¨ê²¨ì£¼ì‹  ëŒ“ê¸€ ë³´ì‹œë©´ ìì„¸í•˜ê²Œ ì„¤ëª…í•´ì£¼ì…¨ìŠµë‹ˆë‹¤.

- "ë„¥ìŠ¤íŠ¸ì—ì„œ ìì²´ì ìœ¼ë¡œ client.fetch url ì—ëŒ€í•œ responseë¥¼ ìºì‹±ì—ì„œ json íŒŒì¼ë¡œ revalidate ì‹œê°„ì„ ì•„ì£¼ ê¸¸ê²Œí•´ì„œ ì €ì¥í•´ë†“ê³  ìˆì—ˆë”ë¼êµ¬ìš”.

- (.next/cache/fetch-cache í´ë”ì—ì„œ jsoníŒŒì¼ë¡œ í™•ì¸ê°€ëŠ¥í•˜ì…”ìš”.)

- í•´ê²°ë°©ë²•ì€ client.fetch ë©”ì†Œë“œ 3ë²ˆì§¸ ì¸ìì—

  - {cache: 'no-store' } ìºì‹œì˜µì…˜ ì¶”ê°€í•´ì£¼ëŠ”ê±°ì—ìš”."

```ts
export async function getSavedPostsOf(username: string) {
  return client
    .fetch(
      `
        *[_type == "post" && _id in *[_type=="user" && username=="${username}"].bookmarks[]._ref]
        | order(_createdAt desc){
            ${simplePostProjection}
        }
    `,
      {},
      {
        cache: "no-cache",
      }
    )
    .then(mapPosts);
}
```

- getLikedPostsOf í•¨ìˆ˜ì—ë„ ë™ì¼í•˜ê²Œ ì ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

- ê´€ë ¨ë¬¸ì„œ

  - https://nextjs.org/docs/app/building-your-application/caching

---

## 14.17 ì½”ë©˜íŠ¸ğŸ’¡- ì„±ëŠ¥ê°œì„ 

- post(post.ts)ê°€ ì—…ë°ì´íŠ¸ ë˜ì—ˆì„ ë•Œ posts(posts.ts)ê°€ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì–´ì„œ

- ìƒì„¸ í˜ì´ì§€ì— ëª¨ë‹¬ì—ì„œ ëŒ“ê¸€ì„ ì…ë ¥í•´ë„ ëª¨ë‹¬ì„ ë‹«ê³  ëŒ“ê¸€ ê°¯ìˆ˜ë¥¼ í™•ì¸í•´ë³´ë©´ ëŒ“ê¸€ ê°¯ìˆ˜ê°€ ë³€í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œì¸ ë¬¸ì œê°€ ìˆë‹¤.

- ì´ë ‡ê²Œ boundëœ mutateë¡œ í•´ê²°ë˜ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ global mutateë¡œ í•´ê²°í•´ì¤€ë‹¤

---

## 14.19 íŒ”ë¡œìš° ë²„íŠ¼ğŸ’¡- ì„œë²„

- [Multiple mutations in a transaction](https://www.sanity.io/docs/js-client#multiple-mutations-in-a-transaction)
